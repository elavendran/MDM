# Sign in to Microsoft Graph
Connect-MgGraph -Scopes "DeviceManagementConfiguration.Read.All"

# Retrieve and list Autopilot devices
$autopilotDevices = Get-MgDeviceManagementImportedDeviceIdentity -All

foreach ($device in $autopilotDevices) {
    Write-Output "Device ID: $($device.ImportedDeviceIdentifier)"
    Write-Output "Hardware Hash: $($device.HardwareIdentifier)"
    Write-Output "-------------------------"
}

# Sign out after the operation
Disconnect-MgGraph